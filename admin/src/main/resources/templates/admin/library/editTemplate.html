<div class="content-header" xmlns:th="http://www.w3.org/1999/xhtml">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">编辑模板</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a th:href="@{admin}">首页</a></li>
                    <li class="breadcrumb-item active">数据库管理</li>
                    <li class="breadcrumb-item active">添加模板</li>
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- Main content -->
<section class="content">
    <div class="card card-info">
        <form id="templateForm">
            <div class="needs-validation form-inline">
                <div class="form-group"  style="width: 500px;">
                    <label for="libType" style="width: 100px">数据库类型:</label>
                    <select id="libType" disabled class="form-control m-2" required
                            style="width: 220px;margin-left: -200px">
                        <option th:selected="${template} ne null and ${template.dbType eq library.name}"
                                th:each="library:${libraries}" th:value="${library.id}"
                                th:text="${library.name}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="libraryId" style="width: 100px">数据库:</label>
                    <select id="libraryId" class="form-control m-2" name="dbId" disabled="true" style="width: 220px"
                            required>
                        <option th:value="${template.dbId}" th:text="${template.dbName}"></option>
                    </select>
                    <input type="hidden" id="templateFlag" value="template"/>
                    <input type="hidden" name="id" th:value="${template.id}"/>
                </div>
            </div>
            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="libraryId" style="width: 100px">模板:</label>
                    <select id="templateId" name="templateId" class="form-control" placeholder="选择模板"
                            style="width: 220px">
                        <option selected value="">选择模板</option>
                        <option th:each="item:${templates}" th:selected="${item.id eq template.templateId}"
                                th:value="${item.id}"
                                th:text="${item.templateName}"></option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="resourceTypeBookRead" style="width: 100px">整书阅读:</label>
                    <input id="resourceTypeBookRead" name="resourceTypeBookRead"
                           th:value="${template.resourceTypeBookRead}"
                           style="width: 220px"
                           class="form-control"/>
                    <!--<div class="invalid-feedback">请填写整书阅读</div>-->
                </div>
            </div>
            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="resourceTypeItemRead" style="width: 100px">条目阅读:</label>
                    <input id="resourceTypeItemRead" name="resourceTypeItemRead"
                           th:value="${template.resourceTypeItemRead}" style="width: 220px"
                           class="form-control"/>
                </div>
                <div class="form-group">
                    <label for="resourceTypeItemDownload" style="width: 100px">条目下载:</label>
                    <input id="resourceTypeItemDownload" name="resourceTypeItemDownload"
                           th:value="${template.resourceTypeItemDownload}" style="width: 220px"
                           class="form-control m-2"/>
                </div>
            </div>
            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="bigAlbum" style="width: 100px">专辑大Logo</label>
                    <input id="bigAlbum" type="text" readonly name="bigAlbumLogo" value=""
                           class="form-control" th:value="${template.bigAlbumLogo}" style="width: 220px"/>
                    <div class="btn btn-default input-group-btn coverUploaderbigAlbum"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <label class="bigAlbumPictureLabel"></label>
                </div>
                <div class="form-group row">
                    <label style="width: 100px">专辑小Logo:</label>
                    <input id="samllAlbum" type="text" readonly name="smallAlbumLogo" style="width: 220px"
                           class="form-control" th:value="${template.smallAlbumLogo}" placeholder="上传专题小Logo"/>
                    <div class="btn btn-default input-group-btn coverUploadersamllAlbum"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                </div>
                <label class="samllAlbumPictureLabel"></label>
            </div>

            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="homepagePicture" style="width: 100px">首页底图:</label>
                    <input id="homepagePicture" type="text" readonly name="homepagePicture"
                           style="width: 220px" th:value="${template.homepagePicture}"
                           class="form-control"/>
                    <div class="btn btn-default input-group-btn coverUploaderhomepage"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <label class="homepagePictureLabel"></label>
                </div>
                <div class="form-group row">
                    <label style="width: 100px">二级页面底图:</label>
                    <input id="secondLevelPicture" type="text" readonly name="secondLevelPicture"
                           style="width: 220px" th:value="${template.secondLevelPicture}"
                           class="form-control"/>
                    <div class="btn btn-default input-group-btn coverUploadersecondLevel"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <label class="secondLevelPictureLabel"></label>
                </div>
            </div>

            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="thematicClassification" style="width: 100px">专题分类:</label>
                    <input id="thematicClassification" type="text" th:value="${template.thematicClassification}"
                           name="thematicClassification"
                           class="form-control" placeholder="填写专题分类" style="width: 220px"/>
                </div>
                <div class="form-group row">
                    <label for="thematicClassification" style="width: 100px">专题分类图片:</label>
                    <input id="classificationPicture" type="text" readonly name="classificationPicture"
                           class="form-control" style="width: 220px" th:value="${template.classificationPicture}"/>
                    <div class="btn btn-default input-group-btn coverUploaderThemat"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <label class="classificationPictureLabel"></label>
                </div>
            </div>

            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row" style="width: 500px;">
                    <label for="areaClassification" style="width: 100px">地区分类:</label>
                    <input id="areaClassification" type="text" name="areaClassification"
                           class="form-control" style="width: 220px" th:value="${template.areaClassification}"/>
                </div>
                <div class="form-group row">
                    <label for="areaClassification" style="width: 100px">地区分类图片:</label>
                    <input id="areaClassificationPicture" type="text" readonly
                           name="areaClassificationPicture" value=""
                           class="form-control" style="width: 220px"
                           th:value="${template.areaClassificationPicture}"/>
                    <div id="upload-img-btn" class="btn btn-default input-group-btn coverUploaderArea"
                         style="min-width: 50px">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <label class="areaClassificationLabel"></label>
                </div>
            </div>

            <div class="needs-validation form-inline" style="margin-left: 15px">
                <div class="form-group row"  style="width: 500px;">
                    <label for="buttonColor" style="width: 100px">按钮颜色:</label>
                    <input id="buttonColor" type="color" name="buttonColor" th:value="${template.buttonColor}"
                           class="form-control" placeholder="填写按钮颜色" style="width: 220px"/>
                </div>
                <div class="form-group row">
                    <label for="clickColor" style="width: 100px">点击/滑过颜色:</label>
                    <input id="clickColor" type="color"
                           name="clickColor" th:value="${template.clickColor}"
                           class="form-control" style="width: 220px" placeholder="填写点击/滑过颜色"/>
                </div>
            </div>
            <div class="needs-validation form-inline" style="margin-left: 15px">
                <button class="btn btn-primary" type="button" id="btn_save">保存</button>
            </div>

        </form>
    </div>

</section>

<script>
    $(function () {
        initChain();
    })
    $('#btn_save').on('click', function () {
        var $f = $('#templateForm');
        var valid = $f[0].checkValidity();
        if ($('#libType').val().trim() === '') {
            layer.msg("请选择类型！");
        } else if ($('#libraryId').val().trim() === '') {
            layer.msg("请选择数据库！");
        } else if ($('#templateId').val().trim() === '') {
            layer.msg("请选择模板！");
        } else if (valid) {
            var url = '/template/addTemplate'
            $f.addClass("was-validated")
            Core.mask("#btn_save");
            $("#libraryId").attr("disabled", false);
            Core.postAjax(url, $f.serialize(), function (data) {
                $("#libraryId").attr("disabled", true);
                Core.unmask("#btn_save");
                layer.msg(data.msg);
                $f.removeClass("was-validated")
                if (data.status == 200) {
                    window.location.href = "#template/listTemplate";
                }
            }, function () {
                Core.unmask("#btn_save");
            },)
        }
        // $f.addClass("was-validated")
    })

    $(function () {
        /*地区上传图片*/
        $(".coverUploaderArea").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf',
            compress :false
        }, function (url) {
            $("#areaClassificationPicture").val(url);
        });

        /*专题上传图片*/
        $(".coverUploaderThemat").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf',
            compress :false
        }, function (url) {
            $("#classificationPicture").val(url);
        });

        /*二级页面底图上传图片*/
        $(".coverUploadersecondLevel").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf',
            compress :false
        }, function (url) {
            $("#secondLevelPicture").val(url);
        });

        /*首页上传图片*/
        $(".coverUploaderhomepage").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf',
            compress :false
        }, function (url) {
            $("#homepagePicture").val(url);
        });

        /*专题小Logo上传图片*/
        $(".coverUploadersamllAlbum").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf'
        }, function (url) {
            $("#samllAlbum").val(url);
        });

        /*专题大Logo上传图片*/
        $(".coverUploaderbigAlbum").upload({
            server: 'attachment/upload/5',
            swf: '/admin/img/Uploader.swf'
        }, function (url) {
            $("#bigAlbum").val(url);
        });

    })


    $('#templateId').change(function () {
        var id=$(this).val();
        templateInfo(id);
    });

    $(function () {
        var id=$('#templateId').val();
        templateInfo(id);
    });

    function templateInfo(id) {
        Core.postAjax("/template/templateInfo", {"id": id}, function (data) {
            $('.bigAlbumPictureLabel').text(data.bigAlbumLogo);
            $('.samllAlbumPictureLabel').text(data.smallAlbumLogo);
            $('.homepagePictureLabel').text(data.homepagePicture);
            $('.secondLevelPictureLabel').text(data.secondLevelPicture);
            $('.classificationPictureLabel').text(data.classificationPicture);
            $('.areaClassificationLabel').text(data.areaClassificationPicture);
        })
    }
</script>